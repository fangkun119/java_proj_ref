# CH01 整体架构详解

> 以电商项目为例子，介绍各类的技术方案

## 01 背景

> 系统：服务 + 数据存储
>
> 电商业务分类
>
> 常见术语：PV、UV、CR（转化率）、SPU（标准化产品单元）、SKU（库存量单位）

## 02 项目设计考虑点

> 容量规划，架构设计，数据库设计，缓存设计，框架选型，数据迁移方案，性能压测，监控报警，领域模型，回滚方案，高并发，分库分表

## 03 项目代码介绍

## 04 技术演进

→ 在同一个JVM内部进行调用：低可用性问题

→ 引入负载均衡（F5、Nginx、LVS）：session共享问题

→ 分布式session：实现服务器负载均衡，但是数据库性能瓶颈仍然存在

> 1. `Session Sticky`：根据ip hash进行负载均衡，同一个ip的请求落在同一台机器上
>
>     资源浪费、单点故障问题、无法根据性能状况调整负载
>
> 2. `Session Relication`：通过session拷贝的方式，来让其他机器也可以处理相同请求
>
>     消耗内存和宽带、数据同步延时、频繁通信
>
> 3. `Session Center`：例如使用redis来存储Session信息
>
>     需要增加额外技术，是目前互联网项目主要采用的方法

→ 数据库优化：解决数据库承载能力之后，仍然存在资源浪费问题、各部门系统耦合在一起的问题

> 1. 更先进的数据库
>
>     mysql → oracle → tidb 
>
>     RMDB → Redis，Elasticsearch
>
> 2. 分库分表、读写分离
>
>     基于Jdbc：ShardingShpere、tddl
>
>     基于proxy：mycat、mysql proxy

→ 业务中台拆分、服务拆分，解决了部门系统耦合的问题，但是带来如下新问题

> (1) 服务之间调用依赖增多
>
> (2) RPC调用（Dubbo、Feign、Http）之间出现异步化需求
>
> (3) 分布式事务（跨数据库事务，访问多个服务的事务）保证：Seata
>
> (4) 消息中间件需求，提供异步、降级、解耦、削峰填谷的功能，带来消息重复、消息丢失、消息挤压、幂等性的问题

常见接口幂等性解决方案

> * 全局唯一ID
> * 去重表
> * 状态机

## 05 Cloud Native

> Zookeeper，Dubbo，Redis，Kafka，RocketMQ，……等各种结束
>
> DevOps、持续交付、容器化

